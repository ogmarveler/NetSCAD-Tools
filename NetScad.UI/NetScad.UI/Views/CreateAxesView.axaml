<UserControl
    x:Class="NetScad.UI.Views.CreateAxesView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:NetScad.UI.Views"
    xmlns:conv="using:NetScad.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:NetScad.UI.ViewModels"
    d:DesignHeight="720"
    d:DesignWidth="1280"
    x:CompileBindings="True"
    x:DataType="vm:CreateAxesViewModel"
    Background="{DynamicResource WindowBackground}"
    mc:Ignorable="d">

    <UserControl.Resources>
        <conv:DoubleToNullableConverter x:Key="DoubleToNullableConverter" />
        <conv:UnitTextConverter x:Key="UnitTextConverter" />
        <conv:UnitSystemToColorConverter x:Key="UnitSystemToColorConverter" />
        <conv:EnumDescriptionConverter x:Key="EnumDescriptionConverter" />
        <conv:CollectionCountToBooleanConverter x:Key="CollectionCountToBooleanConverter" />
        <conv:ThemeToIconConverter x:Key="ThemeToIconConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <!--  Global DataGrid header centering  -->
        <Style Selector="DataGridColumnHeader">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="MinHeight" Value="28" />
        </Style>

        <!--  Metric-specific styling (inherits centering)  -->
        <Style Selector="DataGrid#AxesListMetric DataGridColumnHeader">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="{DynamicResource BlueForeground}" />
            <Setter Property="Foreground" Value="{DynamicResource BlueBackground}" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <!--  Imperial-specific styling (inherits centering)  -->
        <Style Selector="DataGrid#AxesListImperial DataGridColumnHeader">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="Background" Value="{DynamicResource TealForeground}" />
            <Setter Property="Foreground" Value="{DynamicResource TealBackground}" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <!--  Compact cell styling  -->
        <Style Selector="DataGridCell">
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="MinHeight" Value="24" />
            <Setter Property="FontSize" Value="15" />
        </Style>

        <!--  Round the internal DataGrid border to match CornerRadius  -->
        <Style Selector="DataGrid /template/ Border#DataGridBorder">
            <Setter Property="CornerRadius" Value="6" />
        </Style>

        <!--  Standard TextBox Style  -->
        <Style Selector="TextBox.standardInput">
            <Setter Property="Height" Value="32" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="SelectionBrush" Value="Yellow" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <!--  Standard TextBlock Label Style  -->
        <Style Selector="TextBlock.standardLabel">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <!--  Standard StackPanel Style  -->
        <Style Selector="StackPanel.inputGroup">
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="Spacing" Value="3" />
            <Setter Property="Margin" Value="0" />
        </Style>

        <!--  ComboBox Height Alignment  -->
        <Style Selector="ComboBox">
            <Setter Property="Height" Value="32" />
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Margin" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <!--  Button Styles  -->
        <Style Selector="Button">
            <Setter Property="HorizontalAlignment" Value="Stretch" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Height" Value="32" />
            <Setter Property="MinWidth" Value="100" />
            <Setter Property="Margin" Value="0" />
        </Style>
    </UserControl.Styles>

    <Grid x:Name="MainLayoutGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  Input Controls  -->
            <RowDefinition Height="Auto" />
            <!--  DataGrids  -->
            <RowDefinition Height="Auto" />
            <!--  Overflow Row for Imperial Grids when narrow  -->
            <RowDefinition Height="Auto" />
            <!--  Overflow Row for Metric Grids when narrow  -->
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="960" />
            <ColumnDefinition Width="Auto" MinWidth="960" />
            <!--  Reserved for future use  -->
        </Grid.ColumnDefinitions>

        <!--  Main Input Section  -->
        <Border
            Grid.Row="0"
            Grid.Column="0"
            Margin="10,10,10,20"
            BorderThickness="2"
            BoxShadow="1 1 2 0 Gray"
            Classes="card_main">
            <StackPanel Margin="10,20,20,25" Spacing="0">
                <Grid
                    x:Name="MainInputGrid"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    ColumnSpacing="15"
                    RowSpacing="35">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" MinWidth="140" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                        <ColumnDefinition Width="Auto" MinWidth="110" />
                    </Grid.ColumnDefinitions>

                    <!--  Row 0: Title  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="0"
                        Width="140"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Classes="inputGroup">
                        <TextBlock
                            HorizontalAlignment="Stretch"
                            Classes="textbox"
                            FontSize="15"
                            FontWeight="SemiBold"
                            Opacity="0.75"
                            Text="Custom Axis" />
                    </StackPanel>

                    <!--  Min X  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="1"
                        Grid.ColumnSpan="2"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Min X" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MinXValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MinXWatermark}" />
                    </StackPanel>

                    <!--  Max X  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="2"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Max X" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MaxXValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MaxXWatermark}" />
                    </StackPanel>

                    <!--  Min Y  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="3"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Min Y" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MinYValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MinYWatermark}" />
                    </StackPanel>

                    <!--  Max Y  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="4"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Max Y" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MaxYValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MaxYWatermark}" />
                    </StackPanel>

                    <!--  Min Z  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="5"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Min Z" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MinZValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MinZWatermark}" />
                    </StackPanel>

                    <!--  Max Z  -->
                    <StackPanel
                        Grid.Row="0"
                        Grid.Column="6"
                        Width="110"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Max Z" />
                        <TextBox
                            Classes="standardInput"
                            Text="{Binding MaxZValue, Mode=TwoWay, Converter={StaticResource DoubleToNullableConverter}}"
                            Watermark="{Binding MaxZWatermark}" />
                    </StackPanel>

                    <!--  Unit Type ComboBox  -->
                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="0"
                        Width="140"
                        Margin="10,0,0,0"
                        HorizontalAlignment="Left"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Unit Type" />
                        <ComboBox
                            x:Name="UnitComboBox"
                            HorizontalAlignment="Stretch"
                            ItemsSource="{Binding UnitSystemValues}"
                            PlaceholderText="Select Unit"
                            SelectedItem="{Binding SelectedUnitValue, Mode=TwoWay}">
                            <ComboBox.Foreground>
                                <Binding
                                    Converter="{StaticResource UnitSystemToColorConverter}"
                                    ConverterParameter="Foreground"
                                    Path="IsMetric" />
                            </ComboBox.Foreground>
                            <ComboBox.Background>
                                <Binding
                                    Converter="{StaticResource UnitSystemToColorConverter}"
                                    ConverterParameter="Background"
                                    Path="IsMetric" />
                            </ComboBox.Background>
                            <ComboBox.BorderBrush>
                                <Binding
                                    Converter="{StaticResource UnitSystemToColorConverter}"
                                    ConverterParameter="BorderBrush"
                                    Path="IsMetric" />
                            </ComboBox.BorderBrush>
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!--  Background Theme ComboBox  -->
                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="1"
                        Width="110"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="Theme" />
                        <ComboBox
                            HorizontalAlignment="Stretch"
                            ItemsSource="{Binding BackgroundTypeValues}"
                            PlaceholderText="Select Theme"
                            SelectedItem="{Binding SelectedBackgroundValue, Mode=TwoWay}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <!--  Create Axis Button  -->
                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="2"
                        Width="110"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="" />
                        <Button
                            BorderBrush="{DynamicResource CardForeground}"
                            BorderThickness="1"
                            Click="CreateCustomAxis"
                            Content="Create Axis"
                            FontWeight="SemiBold"
                            Foreground="{DynamicResource CardForeground}"
                            IsEnabled="{Binding CreateButtonEnabled}">
                            <ToolTip.Tip>
                                <TextBlock Text="Generate a custom axis based on input coordinates" />
                            </ToolTip.Tip>
                        </Button>
                    </StackPanel>

                    <!--  Clear Inputs Button  -->
                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="3"
                        Width="110"
                        Classes="inputGroup">
                        <TextBlock Classes="standardLabel" Text="" />
                        <Button
                            BorderBrush="{DynamicResource CardForeground}"
                            BorderThickness="1"
                            Click="ClearInputsAsync"
                            Content="Clear Inputs">
                            <ToolTip.Tip>
                                <TextBlock Text="Clear all input fields and reset to defaults" />
                            </ToolTip.Tip>
                        </Button>
                    </StackPanel>

                    <!--  Module Name  -->
                    <StackPanel
                        Grid.Row="1"
                        Grid.Column="4"
                        Grid.ColumnSpan="3"
                        Width="360"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Classes="inputGroup">

                        <StackPanel
                            Margin="0,20,0,0"
                            VerticalAlignment="Center"
                            Orientation="Horizontal"
                            Spacing="60">

                            <!--  Volume Display (Horizontal Layout)  -->
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock
                                    Classes="standardLabel"
                                    FontSize="13"
                                    Text="Volume:" />
                                <TextBlock
                                    FontSize="13"
                                    FontWeight="SemiBold"
                                    Text="{Binding TotalCubicVolume, StringFormat={}{0:N2}}" />
                                <TextBlock
                                    FontSize="13"
                                    IsVisible="{Binding IsMetric}"
                                    Text="cm続" />
                                <TextBlock
                                    FontSize="13"
                                    IsVisible="{Binding IsImperial}"
                                    Text="in続" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <TextBlock
                                    Classes="standardLabel"
                                    FontSize="13"
                                    Text="Scale Volume:" />
                                <TextBlock
                                    FontSize="13"
                                    FontWeight="SemiBold"
                                    Text="{Binding TotalCubicVolumeScale, StringFormat={}{0:N2}}" />
                                <TextBlock
                                    FontSize="13"
                                    IsVisible="{Binding IsMetric}"
                                    Text="m続" />
                                <TextBlock
                                    FontSize="13"
                                    IsVisible="{Binding IsImperial}"
                                    Text="ft続" />
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Border>

        <ScrollViewer
            x:Name="MetricAxisGrid"
            Grid.Row="0"
            Grid.RowSpan="3"
            Grid.Column="0"
            VerticalAlignment="Stretch"
            HorizontalContentAlignment="Left"
            VerticalContentAlignment="Top"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto">
            <ScrollViewer.IsVisible>
                <MultiBinding Converter="{x:Static BoolConverters.Or}">
                    <Binding
                        Converter="{StaticResource CollectionCountToBooleanConverter}"
                        ConverterParameter="1"
                        Path="AxesListMetric" />
                    <Binding
                        Converter="{StaticResource CollectionCountToBooleanConverter}"
                        ConverterParameter="1"
                        Path="AxesListImperial" />
                </MultiBinding>
            </ScrollViewer.IsVisible>
            <Border
                Margin="10,10,10,20"
                Background="Transparent"
                BorderBrush="Transparent"
                BorderThickness="0"
                BoxShadow="1 1 2 0 Gray"
                ClipToBounds="True">
                <StackPanel Margin="0" Spacing="20">
                    <!--  Metric Axes DataGrid  -->
                    <DataGrid
                        x:Name="AxesListMetric"
                        VerticalAlignment="Stretch"
                        AutoGenerateColumns="True"
                        AutoGeneratingColumn="DataGrid_AutoGeneratingColumnMetric"
                        Background="{DynamicResource CardBackground}"
                        BorderBrush="{DynamicResource BlueForeground}"
                        BorderThickness="1"
                        CanUserReorderColumns="False"
                        CanUserResizeColumns="False"
                        ClipToBounds="True"
                        CornerRadius="6"
                        GridLinesVisibility="All"
                        IsReadOnly="True"
                        IsVisible="{Binding AxesListMetric, Converter={StaticResource CollectionCountToBooleanConverter}, ConverterParameter=1}"
                        ItemsSource="{Binding AxesListMetric}"
                        SelectionChanged="DataGridMetric_SelectionChanged"
                        SelectionMode="Single" />


                    <!--  Imperial Axes DataGrid  -->
                    <DataGrid
                        x:Name="AxesListImperial"
                        VerticalAlignment="Stretch"
                        AutoGenerateColumns="True"
                        AutoGeneratingColumn="DataGrid_AutoGeneratingColumnImperial"
                        Background="{DynamicResource CardBackground}"
                        BorderBrush="{DynamicResource TealForeground}"
                        BorderThickness="1"
                        CanUserReorderColumns="False"
                        CanUserResizeColumns="False"
                        ClipToBounds="True"
                        CornerRadius="6"
                        GridLinesVisibility="All"
                        IsReadOnly="True"
                        IsVisible="{Binding AxesListImperial, Converter={StaticResource CollectionCountToBooleanConverter}, ConverterParameter=1}"
                        ItemsSource="{Binding AxesListImperial}"
                        SelectionChanged="DataGridImperial_SelectionChanged"
                        SelectionMode="Single" />
                </StackPanel>
            </Border>
        </ScrollViewer>

        <!--  Modal Overlay (renders on top)  -->
        <controls:ModalDialog
            Title="{Binding ModalTitle}"
            Grid.Row="0"
            Grid.RowSpan="7"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            IsOpen="{Binding IsModalOpen, Mode=TwoWay}">
            <controls:ModalDialog.Content>
                <TextBlock
                    FontFamily="Courier New"
                    Text="{Binding ModalContent}"
                    TextWrapping="Wrap" />
            </controls:ModalDialog.Content>
        </controls:ModalDialog>
    </Grid>
</UserControl>